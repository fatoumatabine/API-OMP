openapi: 3.0.0
info:
  title: OMPAY API
  version: 1.0.0
  description: API documentation for OMPAY payment system
  contact:
    name: API Support
    email: support@ompay.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://127.0.0.1:8000
    description: Development server

paths:
  /api/auth/login:
    post:
      tags:
        - Authentification
      summary: Login user
      description: Login with phone number and password to get JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phone_number:
                  type: string
                  example: "+33612345678"
                  description: "Phone number used during registration"
                password:
                  type: string
                  format: password
                  example: "SecurePassword123"
              required:
                - phone_number
                - password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "OTP sent successfully"
                  requires_otp_verification:
                    type: boolean
                    example: true
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '500':
          description: Server error

  /api/auth/verify-otp:
    post:
      tags:
        - Authentification
      summary: Verify OTP
      description: Verify the OTP sent to user's phone or email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phone_or_email:
                  type: string
                  example: "1234567890"
                otp:
                  type: string
                  example: "123456"
              required:
                - phone_or_email
                - otp
      responses:
        '200':
          description: OTP verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Login successful"
                  token:
                    type: string
                    example: "eyJ0eXAiOiJKV1QiLCJhbGc..."
        '422':
          description: Invalid OTP
        '500':
          description: Server error

  /api/auth/resend-otp:
    post:
      tags:
        - Authentification
      summary: Resend OTP
      description: Resend OTP to user's phone or email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phone_or_email:
                  type: string
                  example: "1234567890"
              required:
                - phone_or_email
      responses:
        '200':
          description: OTP resent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "OTP resent successfully"
        '422':
          description: Validation error
        '500':
          description: Server error

  /api/register:
    post:
      tags:
        - Authentification
      summary: Register new user
      description: Register a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phone_number:
                  type: string
                  example: "+33612345678"
                first_name:
                  type: string
                  example: "Jean"
                last_name:
                  type: string
                  example: "Dupont"
                email:
                  type: string
                  format: email
                  example: "jean.dupont@example.com"
                password:
                  type: string
                  format: password
                  example: "SecurePassword123"
                password_confirmation:
                  type: string
                  format: password
                  example: "SecurePassword123"
                pin_code:
                  type: string
                  example: "1234"
                  description: "4-digit PIN code"
                cni_number:
                  type: string
                  example: "123456789"
              required:
                - phone_number
                - first_name
                - last_name
                - email
                - password
                - password_confirmation
                - pin_code
                - cni_number
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "User registered successfully"
                  user:
                    $ref: '#/components/schemas/User'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '500':
          description: Server error

  /api/auth/create-pin:
    post:
      tags:
        - Authentification
      summary: Create transaction PIN
      description: Create a 4-digit PIN for transactions
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pin:
                  type: string
                  example: "1234"
                pin_confirmation:
                  type: string
                  example: "1234"
              required:
                - pin
                - pin_confirmation
      responses:
        '200':
          description: PIN created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "PIN created successfully"
        '422':
          description: Validation error
        '401':
          description: Unauthorized

  /api/auth/change-pin:
    post:
      tags:
        - Authentification
      summary: Change transaction PIN
      description: Change the transaction PIN
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                old_pin:
                  type: string
                  example: "1234"
                new_pin:
                  type: string
                  example: "5678"
                new_pin_confirmation:
                  type: string
                  example: "5678"
              required:
                - old_pin
                - new_pin
                - new_pin_confirmation
      responses:
        '200':
          description: PIN changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "PIN changed successfully"
        '422':
          description: Validation error
        '401':
          description: Unauthorized

  /api/auth/refresh-token:
    post:
      tags:
        - Authentification
      summary: Refresh access token
      description: Refresh the JWT access token
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Token refreshed successfully"
                  token:
                    type: string
                    example: "eyJ0eXAiOiJKV1QiLCJhbGc..."
        '401':
          description: Unauthorized

  /api/auth/logout:
    post:
      tags:
        - Authentification
      summary: Logout
      description: Logout the current user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Logout successful"
        '401':
          description: Unauthorized

  /api/wallet/balance:
    get:
      tags:
        - Portefeuille
      summary: Get wallet balance
      description: Get the current wallet balance
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Balance retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      balance:
                        type: number
                        format: float
                        example: 1000.50
                      currency:
                        type: string
                        example: "XOF"
        '401':
          description: Unauthorized

  /api/wallet/deposit:
    post:
      tags:
        - Portefeuille
      summary: Deposit money
      description: Deposit money into wallet
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                  format: float
                  example: 50000
                payment_method:
                  type: string
                  enum: [card, bank_transfer, mobile_money]
                  example: "card"
              required:
                - amount
                - payment_method
      responses:
        '200':
          description: Deposit initiated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Deposit initiated successfully"
                  transaction_id:
                    type: string
                    example: "TXN-2024-001"
        '422':
          description: Validation error
        '401':
          description: Unauthorized

  /api/transactions/transfer:
    post:
      tags:
        - Transactions
      summary: Transfer money
      description: Transfer money to another user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                recipient_phone:
                  type: string
                  example: "+33612345678"
                amount:
                  type: number
                  format: float
                  example: 5000
                pin:
                  type: string
                  example: "1234"
                description:
                  type: string
                  example: "Payment for services"
              required:
                - recipient_phone
                - amount
                - pin
      responses:
        '200':
          description: Transfer successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Transfer successful"
                  transaction:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "TXN-2024-002"
                      amount:
                        type: number
                        format: float
                        example: 5000
                      status:
                        type: string
                        example: "completed"
                      created_at:
                        type: string
                        format: date-time
        '422':
          description: Validation error
        '401':
          description: Unauthorized
        '400':
          description: Insufficient balance or invalid recipient

  /api/transactions/history:
    get:
      tags:
        - Transactions
      summary: Get transaction history
      description: Get user's transaction history
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: type
          in: query
          schema:
            type: string
            enum: [all, transfer, deposit, withdrawal]
      responses:
        '200':
          description: Transaction history retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "TXN-2024-002"
                        type:
                          type: string
                          example: "transfer"
                        amount:
                          type: number
                          format: float
                          example: 5000
                        recipient:
                          type: string
                          example: "John Doe"
                        status:
                          type: string
                          example: "completed"
                        created_at:
                          type: string
                          format: date-time
        '401':
          description: Unauthorized

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        phone:
          type: string
          example: "+33612345678"
        created_at:
          type: string
          format: date-time

    ValidationError:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "The given data was invalid"
        errors:
          type: object
          properties:
            field_name:
              type: array
              items:
                type: string
              example: ["The field is required"]

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained after successful login

tags:
  - name: Authentification
    description: Authentication endpoints
  - name: Portefeuille
    description: Wallet management endpoints
  - name: Transactions
    description: Transaction endpoints
